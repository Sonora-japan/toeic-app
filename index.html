<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>今週の時事TOEIC：Part 5 模擬問題</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; line-height: 1.6; }
    h1, h2 { color: #003366; }
    .question { margin-bottom: 2em; }
    .result { font-weight: bold; font-size: 1.2em; margin-top: 2em; }
    .correct { color: green; }
    .incorrect { color: red; }
    #timer { font-weight: bold; font-size: 1.1em; margin-bottom: 1em; color: #555; }
    #language-select { margin-bottom: 1em; }
  </style>
</head>
<body>

<h1 id="main-title">📝 今週の時事TOEIC Part 5 模擬問題（全25問）</h1>
<div id="language-select">
  🌐 言語を選択: 
  <select onchange="setLanguage(this.value)">
    <option value="ja">日本語</option>
    <option value="en">English</option>
    <option value="ko">한국어</option>
  </select>
</div>
<div id="timer">🕒 解答時間: 0秒</div>
<form id="toeic-form">
  <div id="questions"></div>
  <button id="submit-button" type="button" onclick="gradeQuiz()">解答を提出する</button>
</form>

<div id="score" class="result"></div>
<div id="time-result" class="result"></div>

<div class="result">
  <h2 id="share-title">📤 結果をSNSでシェアしよう！</h2>
  <p id="share-text">この模擬テストに挑戦したことを友達に知らせよう！</p>
  <button id="share-twitter" onclick="shareOnTwitter()">🕊 X（Twitter）でシェア</button>
  <button id="share-instagram" onclick="captureResult()">📸 Instagram用画像を保存</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// ------------------------------
// ✅ 全機能統合スクリプト開始
// ------------------------------
let currentLang = "ja";
let startTime = Date.now();
const expectedTimeSec = 600;

const quizData = [
  { q: "Shohei Ohtani’s first home run of the season was ______ after a video review.", options: ["awarded", "confirmed", "announced", "received"], answer: "confirmed", explanations: { ja: "VAR判定後にホームランが確認されたため。confirmは『確認する』の意味。", en: "The home run was confirmed after review. 'Confirm' means to verify.", ko: "비디오 판독 후 홈런이 확인되었기 때문입니다. 'confirm'은 확인하다의 의미입니다." } },
  // Q2〜Q25のデータ省略（実際はすべて挿入されます）
];

const translations = {
  ja: {
    title: "📝 今週の時事TOEIC Part 5 模擬問題（全25問）",
    submit: "解答を提出する",
    shareTitle: "📤 結果をSNSでシェアしよう！",
    shareText: "この模擬テストに挑戦したことを友達に知らせよう！",
    twitter: "🕊 X（Twitter）でシェア",
    instagram: "📸 Instagram用画像を保存",
    timeTaken: "⏱ 解答時間は",
    seconds: "秒です。",
    targetTime: "（目安: 600秒）",
    finished: "（時間内に解き終わりました✨）",
    overtime: "（想定時間を超えています⚠️）",
    correct: "正解",
    yourAnswer: "あなたの答え",
    unanswered: "未回答"
  },
  en: {
    title: "📝 This Week's TOEIC Part 5 Practice (25 Questions)",
    submit: "Submit Answers",
    shareTitle: "📤 Share Your Results on Social Media!",
    shareText: "Let your friends know you took this TOEIC practice!",
    twitter: "🕊 Share on X (Twitter)",
    instagram: "📸 Save Image for Instagram",
    timeTaken: "⏱ Time Taken:",
    seconds: " seconds",
    targetTime: " (Target: 600 seconds)",
    finished: " (Finished in time✨)",
    overtime: " (Exceeded expected time⚠️)",
    correct: "Correct",
    yourAnswer: "Your answer",
    unanswered: "Unanswered"
  },
  ko: {
    title: "📝 이번 주 시사 TOEIC Part 5 모의시험 (총 25문제)",
    submit: "답안 제출하기",
    shareTitle: "📤 결과를 SNS에 공유하세요!",
    shareText: "이 모의시험에 도전한 것을 친구들에게 알려보세요!",
    twitter: "🕊 X (트위터)로 공유하기",
    instagram: "📸 인스타그램용 이미지 저장",
    timeTaken: "⏱ 소요 시간:",
    seconds: "초",
    targetTime: " (예상: 600초)",
    finished: " (예상 시간 내 완료✨)",
    overtime: " (예상 시간을 초과⚠️)",
    correct: "정답",
    yourAnswer: "당신의 답",
    unanswered: "무응답"
  }
};

function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem("toeicLang", lang);
  const t = translations[lang];
  document.getElementById("main-title").textContent = t.title;
  document.getElementById("submit-button").textContent = t.submit;
  document.getElementById("share-title").textContent = t.shareTitle;
  document.getElementById("share-text").textContent = t.shareText;
  document.getElementById("share-twitter").textContent = t.twitter;
  document.getElementById("share-instagram").textContent = t.instagram;
}

function gradeQuiz() {
  let correct = 0;
  const scoreDiv = document.getElementById("score");
  const questionDivs = document.querySelectorAll(".question");
  questionDivs.forEach(div => div.querySelectorAll(".explanation")?.forEach(e => e.remove()));

  quizData.forEach((item, index) => {
    const selected = document.querySelector(`input[name=q${index}]:checked`);
    const explanation = document.createElement("p");
    explanation.className = "explanation";
    explanation.style.fontWeight = "normal";
    if (selected && selected.value === item.answer) {
      correct++;
      explanation.innerHTML = `<span class='correct'>✓</span> ${translations[currentLang].correct}：${item.answer}`;
    } else {
      explanation.innerHTML = `<span class='incorrect'>✗</span> ${translations[currentLang].correct}：${item.answer}` + (selected ? `（${translations[currentLang].yourAnswer}: ${selected.value}）` : `（${translations[currentLang].unanswered}）`);
    }
    questionDivs[index].appendChild(explanation);

    if (item.explanations && item.explanations[currentLang]) {
      const detail = document.createElement("p");
      detail.className = "explanation";
      detail.style.fontStyle = "italic";
      detail.textContent = item.explanations[currentLang];
      questionDivs[index].appendChild(detail);
    }
  });

  const percentage = ((correct / quizData.length) * 100).toFixed(1);
  scoreDiv.innerHTML = `${translations[currentLang].correct}数は <span class="correct">${correct}</span> / ${quizData.length}（<strong>${percentage}%</strong>）です！`;

  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  let timeMessage = `${translations[currentLang].timeTaken} ${elapsed}${translations[currentLang].seconds}`;
  timeMessage += elapsed <= expectedTimeSec ? translations[currentLang].finished : translations[currentLang].overtime;
  document.getElementById("time-result").textContent = timeMessage;
}

function shareOnTwitter() {
  const scoreText = document.getElementById("score")?.textContent || "";
  const timeText = document.getElementById("time-result")?.textContent || "";
  const tweetText = encodeURIComponent(`TOEIC Part 5 模擬問題に挑戦しました！
${scoreText}
${timeText}
#TOEIC #英語学習 #模試 #推しTOEIC`);
  const url = encodeURIComponent(window.location.href);
  const tweetUrl = `https://twitter.com/intent/tweet?text=${tweetText}&url=${url}`;
  window.open(tweetUrl, '_blank');
}

function captureResult() {
  const resultArea = document.querySelector('.result');
  html2canvas(resultArea).then(canvas => {
    const link = document.createElement('a');
    link.download = 'toeic_result.png';
    link.href = canvas.toDataURL();
    link.click();
  });
}

window.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem("toeicLang") || "ja";
  setLanguage(savedLang);

  const questionDiv = document.getElementById("questions");
  quizData.forEach((item, index) => {
    const block = document.createElement("div");
    block.className = "question";
    block.innerHTML = `<p><strong>Q${index + 1}:</strong> ${item.q}</p>` +
      item.options.map(opt => `<label><input type='radio' name='q${index}' value='${opt}'> ${opt}</label><br>`).join("");
    questionDiv.appendChild(block);
  });

  setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    document.getElementById("timer").textContent = `🕒 ${translations[currentLang].timeTaken} ${elapsed}${translations[currentLang].seconds} ${translations[currentLang].targetTime}`;
  }, 1000);
});
// ------------------------------
// ✅ 全機能統合スクリプト終了
// ------------------------------
</script>
</body>
</html>
